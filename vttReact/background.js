(()=>{"use strict";function e(e){let i="";if(!e.video||!e.video.video)return;let n=e.video.video;return n=n.includes("fr:")||n.includes("st:")?(t(e.video.video,"st:",";")||"N/A")+" | "+(t(e.video.video,"fr:",";")||"N/A")+" : "+e.video.pxl:e.video.video+" : "+e.video.pxl,i+=n,""!==i.trim()?i:void 0}function i(e){var i;let n="";if(null===(i=e.pixel)||void 0===i?void 0:i.intLive){let i,t=e.pixel.intLive;return""===t.trim()?void console.log("msg.pixel.intLive is empty. Returning undefined."):("3.12"===e.pixel.ver?t.includes("fr:")?(i=t.slice(t.indexOf("fr:")+3).split(";")[0],n+=i):console.log("No 'fr:' found in version 3.12."):e.pixel.SE?(i=t.includes("id:")?t.slice(t.indexOf("id:")+3).split(";")[0]:t,n+=i):t.includes("fr:")?(i=t.slice(t.indexOf("fr:")+3).split(";")[0],n+=i):e.pixel.ver?console.log("No 'fr:' found, and version exists."):(i=t,n+=i),""!==n.trim()?n:void 0)}console.log("Returning undefined (empty _intLiveInfo or missing msg.pixel.intLive)")}function n(e){var i;let n="";if(null===(i=e.pixel)||void 0===i?void 0:i.clickLive){let i,t=e.pixel.clickLive;return"3.12"===e.pixel.ver?(console.info("Parsing for version 3.12"),t.includes("fr:")&&(i=t.slice(t.indexOf("fr:")+3).split(";")[0],n+=i)):e.pixel.SE?(console.info("SINGLE EXECUTION",e.pixel.SE,t),t.includes("id:")?i=t.slice(t.indexOf("id:")+3).split(";")[0]:(i=t,t.includes("fr:")&&(t=t.slice(t.indexOf("fr:")+3).split(";")[0]),i=t,n+=t)):(console.info("NON Single Execution",e.pixel.SE),t.includes("fr:")?(i=t.slice(t.indexOf("fr:")+3).split(";")[0],n+=i):(i=t,n+=t)),""!==n.trim()?n:void 0}console.log("Returning undefined (empty _clickLiveInfo or missing msg.pixel.clickLive)")}function t(e,i,n){let t=e,o=t.slice(t.indexOf(i)+i.length);return o=o.slice(0,o.indexOf(n)),o}function o(e,i){const n=new RegExp("[?&]"+e.replace(/[\[\]]/g,"\\$&")+"(=([^&#]*)|&|#|$)").exec(i);return(null==n?void 0:n[2])?decodeURIComponent(n[2].replace(/\+/g," ")):""}const l=new class{constructor(){this.eventTarget=new EventTarget}emit(e,i){this.eventTarget.dispatchEvent(new CustomEvent(e,{detail:i}))}on(e,i){const n=e=>{i(e.detail)};return this.eventTarget.addEventListener(e,n),n}off(e,i){this.eventTarget.removeEventListener(e,i)}};var s=function(e,i,n,t){return new(n||(n=Promise))((function(o,l){function s(e){try{r(t.next(e))}catch(e){l(e)}}function c(e){try{r(t.throw(e))}catch(e){l(e)}}function r(e){var i;e.done?o(e.value):(i=e.value,i instanceof n?i:new n((function(e){e(i)}))).then(s,c)}r((t=t.apply(e,i||[])).next())}))};let c=null,r="";const d="https://creative.vdx.tv/vdxstudio/projects/";chrome.tabs.onUpdated.addListener(((e,i,n)=>{"complete"===i.status&&(console.log("Tab Refreshed"),function(e){s(this,void 0,void 0,(function*(){var i;if(!e.url)return;r="";const n=e.url.includes("/VVT/customView"),t=e.url.includes("creative.vdx.tv/")||e.url.includes("vdx.exponential.com");if(n&&chrome.tabs.query({lastFocusedWindow:!0,active:!0},(e=>{e.forEach((e=>e.mutedInfo&&chrome.tabs.update(e.id,{muted:!0})))})),!t)return;if(console.log("Loading... demo pages",e.url),!e.url.includes("#"))return;const o=e.url.split("#")[1].split("/")[0];try{const e=yield fetch("https://expotask-showcase.exponential.com/service/demopages",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({method_name:"getdata_bundle_showcase",hash:o})}),i=yield e.json();i.status?console.log("Data Extrected for from demo pages ",o,i):(console.log("No data found from classic url with ",o,` will use /projects/",${o},"/demopages?published=true`),function(e){s(this,void 0,void 0,(function*(){try{console.info(`Fetching data from modern URL 👍 ${d} ${e}`);const i=yield fetch(`${d}${e}/demopages?published=true`),n=yield i.json();r=function(e){var i,n,t,o,l;let s="https://creative.exponential.com/creative/devshowcase/VVT/customView1.html";(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.isCCRV)&&(s="https://creative.exponential.com/creative/devshowcase/VVT/customView1.1.html");const c=(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.urls)||[],r=c.length>0?`${c[0].mockid}_${c[0].ad_size}`:"",d=c.map((e=>`${e.mockid}_${e.ad_size}`)).join(","),a=c.find((e=>"inframe"===e.format&&"mobile"===e.platform)),u=c.find((e=>"expandable"===e.format&&"mobile"===e.platform)),v=c.some((e=>"TV"===e.platform))?1:0,f=(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.isCCRV)||!1,p=(null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.latestRevision)||"",m=(null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.latestVariation)||0;return`${s}?DExp=${r}&DInf=${d}&VCmi=${a?a.mockid+"_"+a.ad_size:""}&VCme=${u?u.mockid+"_"+u.ad_size:""}&CTV=${v}&isCCRV=${f}&latestRevision=${p}&latestVariation=${m}`}(n),console.log("data from demo pages 🧏‍♀️ ",n.data.urls[0].creativeRequestId),console.log(n,":::: ",r),c=n.data.urls,l.emit("dataAvailable",c)}catch(e){console.error("Error fetching data:",e)}}))}(o))}catch(e){console.info(null,null!==(i=null==e?void 0:e.message)&&void 0!==i?i:e)}}))}(n))}));let a={},u={},v=null;function f(){if(console.log("📊 Current DevTools & Tab Status:"),0===Object.keys(u).length)return void console.log("No active DevTools panels.");const e=Object.keys(u).map((e=>({"Tab Id":e,Status:a[+e]?e===String(v)?"Connected ✅ (Active)":"Connected ⚠ (Inactive)":"Disconnected ❌"})));console.table(e)}chrome.runtime.onConnect.addListener((e=>{"devtools"===e.name&&(e.onMessage.addListener((i=>{if("INIT"===i.type&&i.tabId){const n=i.tabId;u[n]=!0,a[n]=e,v=n,console.log(`✅ DevTools connected to background with Tab ID: ${n}`),f()}})),e.onDisconnect.addListener((()=>{let i=null;for(const[n,t]of Object.entries(a))if(t===e){i=parseInt(n);break}null!==i&&(console.log(`❌ DevTools panel closed for Tab ID: ${i}`),delete a[i],delete u[i],i===v&&(v=null),f())})))})),chrome.tabs.onActivated.addListener((e=>{const i=e.tabId;i!==v&&(console.log(`🔄 Switched to Tab ID: ${i}`),u[i]&&a[i]&&(console.log(`🔄 Reconnecting DevTools to already open panel for Tab ID: ${i}`),v=i),f())})),chrome.tabs.onRemoved.addListener((e=>{console.log(`❌ Tab Closed: ${e}`),delete u[e],delete a[e],e===v&&(v=null),f()})),chrome.webRequest.onHeadersReceived.addListener((t=>{if(t.tabId&&-1!==t.tabId){const l=a[t.tabId];l&&(function(i,n){if(i.url.includes("pcLive")&&200===i.statusCode&&null!=o("event",i.url)&&n){const t={video:{video:o("custom1",i.url)||void 0,pxl:o("event",i.url)||void 0}};e(t)&&n.postMessage({type:"PCLIVE_REQUEST",data:e(t)})}}(t,l),function(e,n){if(e.url.includes("intLive")&&200===e.statusCode)if(n){const t=o("custom4",e.url),l=o("custom3",e.url),s=o("custom1",e.url);if(t.includes("id:")){const e={pixel:{intLive:t||void 0,SE:!0}};i(e)&&n.postMessage({type:"IMP_REQUEST",data:i(e)})}if(l.includes("fr:")){const e={pixel:{intLive:l||void 0,ver:"3.12"}};i(e)&&n.postMessage({type:"IMP_REQUEST",data:i(e)})}else{console.info("NON SE");const e={pixel:{intLive:s||void 0,SE:!1}};i(e)&&n.postMessage({type:"IMP_REQUEST",data:i(e)})}}else console.warn("⚠️ DevTools port is null. Cannot send imp URL.")}(t,l),function(e,i){if(e.url.includes("clickLive")&&200===e.statusCode)if(i){const t=o("custom4",e.url),l=o("custom3",e.url),s=o("custom1",e.url);if(t.includes("id:")){const e={pixel:{clickLive:t||void 0,SE:!0}};n(e)&&i.postMessage({type:"CLICK_REQUEST",data:n(e)})}if(l.includes("fr:")){const e={pixel:{clickLive:l||void 0,ver:"3.12"}};n(e)&&i.postMessage({type:"CLICK_REQUEST",data:n(e)})}else{const e={pixel:{clickLive:s||void 0,SE:!0}};n(e)&&i.postMessage({type:"CLICK_REQUEST",data:n(e)})}}else console.warn("⚠️ DevTools port is null. Cannot send imp URL.")}(t,l),function(e,i){if(-1!=e.url.indexOf("designer-config.js")){if(-1!=e.url.indexOf("designerConfig="))return;console.log("Parsing Desi Config.. 🛩️ ",e.url),(n=e.url,fetch(n).then((e=>e.text())).then((e=>{let i=e,n=[],t=[],o=[],l="",s=!1;return e.split("\n").forEach((e=>{if((e=e.trim()).includes("clickLive")){let i=e.replace(/\s/g,"");i.includes("firePixel")&&(i=i.substring(i.indexOf("(")+1,i.indexOf(",")).trim().replace(/['"]/g,"")),i.includes(":")||i.includes('"')||n.push(i)}if(e.includes("intLive")){let i=e.replace(/\s/g,"");i.includes("firePixel")&&i.includes("(")&&i.includes(",")&&(i=i.substring(i.indexOf("(")+1,i.indexOf(",")).trim().replace(/['"]/g,"")),!i||i.includes(":")||i.includes("=")||i.includes("{")||i.includes("}")||t.push(i)}if(e.includes("Expo.designerAPI.fireDynamicPixel")){let i=e.replace(/\s/g,"");i=i.substring(i.indexOf("(")+1,i.indexOf(",")).trim().replace(/['"]/g,""),o.push(i)}e.includes("openUrl")&&(l=e.split('"')[1]||"")})),s=!0,console.log("Parsed intLiveDynamicData:",o),console.log("Parsed lineBreaksOpenUrl:",l),console.log("dapiContent length:",i.length),{clickLiveData:n.filter(Boolean),intLiveData:t.filter(Boolean),intLiveDynamicData:o.filter(Boolean),lineBreaksOpenUrl:l,dapiContent:i,isDesiParsed:!0}})).catch((e=>(console.error("Error fetching designer-config:",e),{clickLiveData:[],intLiveData:[],intLiveDynamicData:[],lineBreaksOpenUrl:"",dapiContent:"",isDesiParsed:!1})))).then((e=>{i&&i.postMessage({type:"DAPI_DATA",data:e})})).catch((e=>console.error("Error parsing designer config:",e)))}var n}(t,l))}}),{urls:["<all_urls>"]},["responseHeaders"]),chrome.contextMenus.create({id:"vdxViewer",title:"VDX Viewer",contexts:["page"]}),chrome.contextMenus.create({id:"customVDXView",title:"Custom VDX View",parentId:"vdxViewer",contexts:["page"]}),console.log("Context menus created successfully!"),chrome.contextMenus.onClicked.addListener(((e,i)=>{var n,t;"customVDXView"===e.menuItemId&&((null===(n=null==i?void 0:i.url)||void 0===n?void 0:n.includes("vdx.tv"))||(null===(t=null==i?void 0:i.url)||void 0===t?void 0:t.includes("creative.vdx.tv"))||chrome.notifications.create((new Date).getTime().toString(),{type:"basic",iconUrl:"icons/icon128.png",title:"Showcase Page Alert",message:"This feature is available for VDX Showcase pages only."}),console.log("the_LANDING_URL :: 🌐 ",r),chrome.tabs.create({url:r}))}))})();